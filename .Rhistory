theme(legend.position='none')
ggboxplot(data=filter(hplot,abs(post.saccade.VOR)<2,post.saccade.VOR< -0.5,abs(post.saccade.head)>10),
x = "blocknum", y="post.saccade.VOR*-1",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
geom_hline(yintercept = 1,linetype=2)+
ylab('Post-saccadic VOR gain')+
xlab('Time Point')
qplot(post.saccade.VOR,binwidth=.1,data=filter(hplot,abs(post.saccade.VOR)<3))+
facet_wrap(~block,ncol=3,scales='free')+
geom_vline(xintercept = 1)+
xlab('VOR gain')
ggplot(hplot)+
geom_boxplot(aes(as.factor(blocknum),post.saccade.VOR,fill=block))+
facet_wrap(~subject,scales='free',ncol=3)+
geom_hline(yintercept = 1,color='red',alpha=0.5)+
theme(legend.position='none')
hplot %>%
filter(hplot,abs(post.saccade.VOR)<2,post.saccade.VOR< -0.5,abs(post.saccade.head)>10)
hplot %>%
filter(hplot,abs(post.saccade.VOR)<2,post.saccade.VOR< -0.5,abs(post.saccade.head)>10) %>%
# filter(abs(post.saccade.VOR)<5,
control,
hplot %>%
filter(abs(post.saccade.VOR)<2,post.saccade.VOR< -0.5,abs(post.saccade.head)>10) %>%
# filter(abs(post.saccade.VOR)<5,
control,
hplot %>%
filter(abs(post.saccade.VOR)<2,post.saccade.VOR< -0.5,abs(post.saccade.head)>10,
# filter(abs(post.saccade.VOR)<5,
control,
blocknum<3) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')+
ggtitle('Control Subjects')
hplot %>%
filter(abs(post.saccade.VOR)<2,post.saccade.VOR> 0.5,abs(post.saccade.head)>10,
# filter(abs(post.saccade.VOR)<5,
control,
blocknum<3) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')+
ggtitle('Control Subjects')
hplot %>%
filter(abs(post.saccade.VOR)<2,post.saccade.VOR> 0.5,abs(post.saccade.head)>10,
# filter(abs(post.saccade.VOR)<5,
control,
blocknum<3) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
geom_hline(yintercept = 1,linetype=2)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')+
ggtitle('Control Subjects')
hplot %>%
ungroup() %>%
filter(subject=='xL16') %>%
filter(blocknum %in% c('5','6')) %>%
mutate(blocknum=as.factor(as.numeric(blocknum)-4))->
hplotXL
hplotconc<-filter(hplot,!control,subject!='xL16',blocknum %in% c('1','2'))
hplotconc<-rbind(ungroup(hplotconc),hplotXL)
hplotconc %>%
filter(abs(post.saccade.VOR)<2,post.saccade.VOR> 0.5,abs(post.saccade.head)>10) %>%
# filter(abs(post.saccade.VOR)<5) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
geom_hline(yintercept = 1,linetype=2)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')
hplot %>%
filter(abs(post.saccade.VOR)<2,post.saccade.VOR> 0.5,abs(post.saccade.head)>10,
# filter(abs(post.saccade.VOR)<5,
control,
blocknum<3) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
geom_hline(yintercept = 1,linetype=2)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')+
ggtitle('Control Subjects')
hplotconc %>%
filter(abs(post.saccade.VOR)<2,post.saccade.VOR> 0.5,abs(post.saccade.head)>10) %>%
# filter(abs(post.saccade.VOR)<5) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
geom_hline(yintercept = 1,linetype=2)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')
# path<- "F:/dropbox/kdata/anti/"
path<- "C:/users/setup/dropbox/kdata/newform/"
library(ggplot2)
library(dplyr)
library(broom)
source('knighthelperfunctions.R')
samplerate<- 304.7508/1000
h<-loadnewheadfree(path=path)
h<-loadnewheadfree(path=path)
#get names of all files in path
files <- list.files(path=path,pattern='*.txt')
#extract neuron name eg. Bee-01
# names<-sapply(files, str_match,"^[a-zA-Z]+-[0-9]+",USE.NAMES=FALSE)
names<-sapply(files, str_match,"^[a-zA-Z0-9]+",USE.NAMES=FALSE)
names
nfiles<-length(files)
message(c('New Files: ',files))
loadedfiles <- lapply(paste(path,files,sep=''),read.csv,sep='\t',header=FALSE)
t<-data.frame()
temp<- NULL
i=1
f<- files[i]
message(paste('Loading:',f))
# temp[[i]]=loadedfiles[[i]]
# names<-str_match(f,"(^[a-zA-Z]+)-([0-9]+)")
# loadedfiles[[i]]$block<-names[1]
# loadedfiles[[i]]$subject<-names[2]
# loadedfiles[[i]]$blocknum<-as.numeric(names[3])
#updated for 2-25-2018
#remove extra rows
loadedfiles[[i]]<- select(loadedfiles[[i]],1:8)
# temp[[i]]=loadedfiles[[i]]
# names<-str_match(f,"(^[a-zA-Z]+)-([0-9]+)")
# loadedfiles[[i]]$block<-names[1]
# loadedfiles[[i]]$subject<-names[2]
# loadedfiles[[i]]$blocknum<-as.numeric(names[3])
#updated for 2-25-2018
#remove extra rows
# loadedfiles[[i]]<- select(loadedfiles[[i]],1:8)
#files are named with Subject ID bU07 and block ST1 with ST standing for Saccade Task
names<-str_match(f,"(^[a-zA-Z0-9]{4})([a-zA-Z0-9]{3})")
loadedfiles[[i]]$block<-names[1]
loadedfiles[[i]]$subject<-names[2]
loadedfiles[[i]]$blocknum<-as.numeric(str_sub(names[3],3))
task<-str_sub(names[3],1,2)
loadedfiles[[i]]$task<- task
if (task=='AS'){ #antisaccade dask needs target data fixed
#'There are three targets in the anti saccade files
#'but only the second is useful. The central fixation is always at zero
#'If this changes, the value in V7 should be used instead of zero
targ<- loadedfiles[[i]]$V8
targ<- replace(targ,targ< -80,0)
loadedfiles[[i]]$V8=targ
}
t <-rbindlist(loadedfiles,fill = TRUE)
head(t)
ncol(t)
h<-loadnewheadfree(path=path)
loadnewheadfree<- function(referencefile=NULL,path="~/GitHub/ConcussionGaze/kdata/"){
require(stringr)
require(dplyr)
require(data.table)
#This function loads .csv files in a particular folder. They must have the same columns for rbind
#Saves time by only reading the csv when necessary
#get names of all files in path
files <- list.files(path=path,pattern='*.txt')
#extract neuron name eg. Bee-01
# names<-sapply(files, str_match,"^[a-zA-Z]+-[0-9]+",USE.NAMES=FALSE)
names<-sapply(files, str_match,"^[a-zA-Z0-9]+",USE.NAMES=FALSE)
# check for new cells
if (!is.null(referencefile)){
files<-files[!names %in% referencefile$neuron] #comparison
}
nfiles<-length(files)
if (nfiles>0){
message(c('New Files: ',files))
loadedfiles <- lapply(paste(path,files,sep=''),read.csv,sep='\t',header=FALSE)
t<-data.frame()
temp<- NULL
# t.old<-NULL
for (i in 1:nfiles) {
f<- files[i]
message(paste('Loading:',f))
# temp[[i]]=loadedfiles[[i]]
# names<-str_match(f,"(^[a-zA-Z]+)-([0-9]+)")
# loadedfiles[[i]]$block<-names[1]
# loadedfiles[[i]]$subject<-names[2]
# loadedfiles[[i]]$blocknum<-as.numeric(names[3])
#updated for 2-25-2018
#remove extra rows
if (ncol(loadedfiles[[i]])>8){
loadedfiles[[i]]<- select(loadedfiles[[i]],1:8)
}
#files are named with Subject ID bU07 and block ST1 with ST standing for Saccade Task
names<-str_match(f,"(^[a-zA-Z0-9]{4})([a-zA-Z0-9]{3})")
loadedfiles[[i]]$block<-names[1]
loadedfiles[[i]]$subject<-names[2]
loadedfiles[[i]]$blocknum<-as.numeric(str_sub(names[3],3))
task<-str_sub(names[3],1,2)
loadedfiles[[i]]$task<- task
if (task=='AS'){ #antisaccade dask needs target data fixed
#'There are three targets in the anti saccade files
#'but only the second is useful. The central fixation is always at zero
#'If this changes, the value in V7 should be used instead of zero
targ<- loadedfiles[[i]]$V8
targ<- replace(targ,targ< -80,0)
loadedfiles[[i]]$V8=targ
}
}
t <-rbindlist(loadedfiles,fill = TRUE)
# t<- dplyr::select(t, -thp,-tvp,-time)
}else{
message('********NO NEW DATA********')
t<-NULL
}
# names(t)<- c('G','GV','H','HV','E','EV','sampletime','Targ','block','subject','blocknum','task')
t %>%
mutate(time=row_number())->
t
return(t)
}
h<-loadnewheadfree(path=path)
loadnewheadfree<- function(referencefile=NULL,path="~/GitHub/ConcussionGaze/kdata/"){
require(stringr)
require(dplyr)
require(data.table)
#This function loads .csv files in a particular folder. They must have the same columns for rbind
#Saves time by only reading the csv when necessary
#get names of all files in path
files <- list.files(path=path,pattern='*.txt')
#extract neuron name eg. Bee-01
# names<-sapply(files, str_match,"^[a-zA-Z]+-[0-9]+",USE.NAMES=FALSE)
names<-sapply(files, str_match,"^[a-zA-Z0-9]+",USE.NAMES=FALSE)
# check for new cells
if (!is.null(referencefile)){
files<-files[!names %in% referencefile$neuron] #comparison
}
nfiles<-length(files)
if (nfiles>0){
message(c('New Files: ',files))
loadedfiles <- lapply(paste(path,files,sep=''),read.csv,sep='\t',header=FALSE)
t<-data.frame()
temp<- NULL
# t.old<-NULL
for (i in 1:nfiles) {
f<- files[i]
message(paste('Loading:',f))
# temp[[i]]=loadedfiles[[i]]
# names<-str_match(f,"(^[a-zA-Z]+)-([0-9]+)")
# loadedfiles[[i]]$block<-names[1]
# loadedfiles[[i]]$subject<-names[2]
# loadedfiles[[i]]$blocknum<-as.numeric(names[3])
#updated for 2-25-2018
#remove extra rows
# if (ncol(loadedfiles[[i]])>8){
#   loadedfiles[[i]]<- select(loadedfiles[[i]],1:8)
# }
#files are named with Subject ID bU07 and block ST1 with ST standing for Saccade Task
names<-str_match(f,"(^[a-zA-Z0-9]{4})([a-zA-Z0-9]{3})")
loadedfiles[[i]]$block<-names[1]
loadedfiles[[i]]$subject<-names[2]
loadedfiles[[i]]$blocknum<-as.numeric(str_sub(names[3],3))
task<-str_sub(names[3],1,2)
loadedfiles[[i]]$task<- task
if (task=='AS'){ #antisaccade dask needs target data fixed
#'There are three targets in the anti saccade files
#'but only the second is useful. The central fixation is always at zero
#'If this changes, the value in V7 should be used instead of zero
targ<- loadedfiles[[i]]$V8
targ<- replace(targ,targ< -80,0)
loadedfiles[[i]]$V8=targ
}
}
t <-rbindlist(loadedfiles,fill = TRUE)
# t<- dplyr::select(t, -thp,-tvp,-time)
}else{
message('********NO NEW DATA********')
t<-NULL
}
# names(t)<- c('G','GV','H','HV','E','EV','sampletime','Targ','block','subject','blocknum','task')
t %>%
mutate(time=row_number())->
t
return(t)
}
h<-loadnewheadfree(path=path)
loadnewheadfree<- function(referencefile=NULL,path="~/GitHub/ConcussionGaze/kdata/"){
require(stringr)
require(dplyr)
require(data.table)
#This function loads .csv files in a particular folder. They must have the same columns for rbind
#Saves time by only reading the csv when necessary
#get names of all files in path
files <- list.files(path=path,pattern='*.txt')
#extract neuron name eg. Bee-01
# names<-sapply(files, str_match,"^[a-zA-Z]+-[0-9]+",USE.NAMES=FALSE)
names<-sapply(files, str_match,"^[a-zA-Z0-9]+",USE.NAMES=FALSE)
# check for new cells
if (!is.null(referencefile)){
files<-files[!names %in% referencefile$neuron] #comparison
}
nfiles<-length(files)
if (nfiles>0){
message(c('New Files: ',files))
loadedfiles <- lapply(paste(path,files,sep=''),read.csv,sep='\t',header=FALSE)
t<-data.frame()
temp<- NULL
# t.old<-NULL
for (i in 1:nfiles) {
f<- files[i]
message(paste('Loading:',f))
# temp[[i]]=loadedfiles[[i]]
# names<-str_match(f,"(^[a-zA-Z]+)-([0-9]+)")
# loadedfiles[[i]]$block<-names[1]
# loadedfiles[[i]]$subject<-names[2]
# loadedfiles[[i]]$blocknum<-as.numeric(names[3])
#updated for 2-25-2018
#remove extra rows
# if (ncol(loadedfiles[[i]])>8){
#   loadedfiles[[i]]<- select(loadedfiles[[i]],1:8)
# }
#files are named with Subject ID bU07 and block ST1 with ST standing for Saccade Task
names<-str_match(f,"(^[a-zA-Z0-9]{4})([a-zA-Z0-9]{3})")
loadedfiles[[i]]$block<-names[1]
loadedfiles[[i]]$subject<-names[2]
loadedfiles[[i]]$blocknum<-as.numeric(str_sub(names[3],3))
task<-str_sub(names[3],1,2)
loadedfiles[[i]]$task<- task
if (task=='AS' & ncol(loadedfiles[[i]])>8){ #antisaccade dask needs target data fixed
#'There are three targets in the anti saccade files
#'but only the second is useful. The central fixation is always at zero
#'If this changes, the value in V7 should be used instead of zero
targ<- loadedfiles[[i]]$V8
targ<- replace(targ,targ< -80,0)
loadedfiles[[i]]$V8=targ
}
}
t <-rbindlist(loadedfiles,fill = TRUE)
# t<- dplyr::select(t, -thp,-tvp,-time)
}else{
message('********NO NEW DATA********')
t<-NULL
}
# names(t)<- c('G','GV','H','HV','E','EV','sampletime','Targ','block','subject','blocknum','task')
t %>%
mutate(time=row_number())->
t
return(t)
}
h<-loadnewheadfree(path=path)
head(h)
loadnewheadfree<- function(referencefile=NULL,path="~/GitHub/ConcussionGaze/kdata/"){
require(stringr)
require(dplyr)
require(data.table)
#This function loads .csv files in a particular folder. They must have the same columns for rbind
#Saves time by only reading the csv when necessary
#get names of all files in path
files <- list.files(path=path,pattern='*.txt')
#extract neuron name eg. Bee-01
# names<-sapply(files, str_match,"^[a-zA-Z]+-[0-9]+",USE.NAMES=FALSE)
names<-sapply(files, str_match,"^[a-zA-Z0-9]+",USE.NAMES=FALSE)
# check for new cells
if (!is.null(referencefile)){
files<-files[!names %in% referencefile$neuron] #comparison
}
nfiles<-length(files)
if (nfiles>0){
message(c('New Files: ',files))
loadedfiles <- lapply(paste(path,files,sep=''),read.csv,sep='\t',header=FALSE)
t<-data.frame()
temp<- NULL
# t.old<-NULL
for (i in 1:nfiles) {
f<- files[i]
message(paste('Loading:',f))
# temp[[i]]=loadedfiles[[i]]
# names<-str_match(f,"(^[a-zA-Z]+)-([0-9]+)")
# loadedfiles[[i]]$block<-names[1]
# loadedfiles[[i]]$subject<-names[2]
# loadedfiles[[i]]$blocknum<-as.numeric(names[3])
#updated for 2-25-2018
#remove extra rows
# if (ncol(loadedfiles[[i]])>8){
#   loadedfiles[[i]]<- select(loadedfiles[[i]],1:8)
# }
#files are named with Subject ID bU07 and block ST1 with ST standing for Saccade Task
names<-str_match(f,"(^[a-zA-Z0-9]{4})([a-zA-Z0-9]{3})")
loadedfiles[[i]]$block<-names[1]
loadedfiles[[i]]$subject<-names[2]
loadedfiles[[i]]$blocknum<-as.numeric(str_sub(names[3],3))
task<-str_sub(names[3],1,2)
loadedfiles[[i]]$task<- task
if (task=='AS' & ncol(loadedfiles[[i]])>8){ #antisaccade dask needs target data fixed
#'There are three targets in the anti saccade files
#'but only the second is useful. The central fixation is always at zero
#'If this changes, the value in V7 should be used instead of zero
targ<- loadedfiles[[i]]$V8
targ<- replace(targ,targ< -80,0)
loadedfiles[[i]]$V8=targ
}
}
t <-rbindlist(loadedfiles,fill = TRUE)
# t<- dplyr::select(t, -thp,-tvp,-time)
}else{
message('********NO NEW DATA********')
t<-NULL
}
if (ncol(t) == 12){
names(t)<- c('G','GV','H','HV','E','EV','sampletime','Targ','block','subject','blocknum','task')
}
if (ncol(t) == 8){
names(t)<-c('Hv','Ep','Targ','block','subject','blocknum','task')
}
t %>%
mutate(time=row_number())->
t
return(t)
}
h<-loadnewheadfree(path=path)
head(h)
ncol(h)
loadnewheadfree<- function(referencefile=NULL,path="~/GitHub/ConcussionGaze/kdata/"){
require(stringr)
require(dplyr)
require(data.table)
#This function loads .csv files in a particular folder. They must have the same columns for rbind
#Saves time by only reading the csv when necessary
#get names of all files in path
files <- list.files(path=path,pattern='*.txt')
#extract neuron name eg. Bee-01
# names<-sapply(files, str_match,"^[a-zA-Z]+-[0-9]+",USE.NAMES=FALSE)
names<-sapply(files, str_match,"^[a-zA-Z0-9]+",USE.NAMES=FALSE)
# check for new cells
if (!is.null(referencefile)){
files<-files[!names %in% referencefile$neuron] #comparison
}
nfiles<-length(files)
if (nfiles>0){
message(c('New Files: ',files))
loadedfiles <- lapply(paste(path,files,sep=''),read.csv,sep='\t',header=FALSE)
t<-data.frame()
temp<- NULL
# t.old<-NULL
for (i in 1:nfiles) {
f<- files[i]
message(paste('Loading:',f))
# temp[[i]]=loadedfiles[[i]]
# names<-str_match(f,"(^[a-zA-Z]+)-([0-9]+)")
# loadedfiles[[i]]$block<-names[1]
# loadedfiles[[i]]$subject<-names[2]
# loadedfiles[[i]]$blocknum<-as.numeric(names[3])
#updated for 2-25-2018
#remove extra rows
# if (ncol(loadedfiles[[i]])>8){
#   loadedfiles[[i]]<- select(loadedfiles[[i]],1:8)
# }
#files are named with Subject ID bU07 and block ST1 with ST standing for Saccade Task
names<-str_match(f,"(^[a-zA-Z0-9]{4})([a-zA-Z0-9]{3})")
loadedfiles[[i]]$block<-names[1]
loadedfiles[[i]]$subject<-names[2]
loadedfiles[[i]]$blocknum<-as.numeric(str_sub(names[3],3))
task<-str_sub(names[3],1,2)
loadedfiles[[i]]$task<- task
if (task=='AS' & ncol(loadedfiles[[i]])>8){ #antisaccade dask needs target data fixed
#'There are three targets in the anti saccade files
#'but only the second is useful. The central fixation is always at zero
#'If this changes, the value in V7 should be used instead of zero
targ<- loadedfiles[[i]]$V8
targ<- replace(targ,targ< -80,0)
loadedfiles[[i]]$V8=targ
}
}
t <-rbindlist(loadedfiles,fill = TRUE)
# t<- dplyr::select(t, -thp,-tvp,-time)
}else{
message('********NO NEW DATA********')
t<-NULL
}
if (ncol(t) == 12){
names(t)<- c('G','GV','H','HV','E','EV','sampletime','Targ','block','subject','blocknum','task')
}
if (ncol(t) == 7){
names(t)<-c('Hv','Ep','Targ','block','subject','blocknum','task')
}
t %>%
mutate(time=row_number())->
t
return(t)
}
h<-loadnewheadfree(path=path)
head(h)
