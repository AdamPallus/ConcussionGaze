ylab('Fraction of Good Trials with Post-saccadic Drift')+
theme_minimal()+
theme(legend.position = 'none')+
xlab('Time Point')+
ggtitle('Control Subjects')
alldriftcount %>%
filter(control=='Concussed') %>%
ggplot(aes(blocknum,driftpercent,fill=subject))+
geom_bar(stat='identity')+
facet_wrap(~subject,scales='free_x')+
ylab('Fraction of Good Trials with Post-saccadic Drift')+
theme_minimal()+
theme(legend.position = 'none')+
xlab('Time Point')
names(alldriftcount)
alldriftcount %>%
mutate(post.block=control=='Concussed' & blocknum == '2')->
alldriftcount
ggpaired(alldriftcount,x='blocknum',y='driftpercent*100',facet='post.block',
palette = 'npg',fill='blocknum',line.color = "gray", line.size = 0.4)+
stat_compare_means(paired=TRUE)+
xlab('Time Point')+
ylab('Post-Saccade VOR Gain')+
theme(legend.position='none')
ggpaired(alldriftcount,x='blocknum',y='driftpercent*100',
palette = 'npg',color='post.block',line.color = "gray", line.size = 0.4)+
stat_compare_means(paired=TRUE)+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
ggpaired(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'npg',color='post.block',line.color = "gray", line.size = 0.4)+
stat_compare_means(paired=TRUE)+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
ggboxplot(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'rickandmorty',color='post.block')+
stat_compare_means(paired=TRUE)+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
ggboxplot(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'simpsons',color='post.block')+
stat_compare_means(paired=TRUE)+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
ggboxplot(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'lancet',color='post.block')+
stat_compare_means(paired=TRUE)+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
ggboxplot(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'lancet',color='post.block')+
stat_compare_means()+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
ggboxplot(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'jco',color='post.block')+
stat_compare_means()+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
levels(post.block)
levels(alldriftcount$post.block)
alldriftcount$post.block<-as.factor(alldriftcount$post.block)
levels(alldriftcount$post.block)
levels(alldriftcount$post.block)<-c('Control and Pre-concussion','Post-concussion')
ggpaired(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'npg',color='post.block',line.color = "gray", line.size = 0.4)+
stat_compare_means(paired=TRUE)+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
ggboxplot(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'lancet',color='post.block')+
stat_compare_means()+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
ggboxplot(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'lancet',color='post.block')+
stat_compare_means()+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
?geom_boxplot
hplotAdjusted %>%
filter(abs(post.saccade.VOR)<5) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')
hplotAdjusted %>%
filter(abs(post.saccade.VOR)<5) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')
hplotAdjusted %>%
filter(abs(post.saccade.VOR)<5) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')+geom_hline(yintercept = -1)
library(ggplot2)
library(dplyr)
library(broom)
source('knighthelperfunctions.R')
samplerate<- 304.7508/1000
path<- "F:/dropbox/kdata/anti/"
h<-loadnewheadfree(path=path)
h<-loadnewheadfree(path=path)
h%>%
select(G,H,Targ,block,subject,task)%>%
group_by(block) %>%
filter(!is.na(G)) %>%
mutate(time=row_number(),
Graw=G,
G=replace(smooth(G,"3R"),G==0,NA), #mark missing data as NA rather than 0
Gnospline=G,
G= applyspline(G,6),
target.velocity=parabolicdiff(Targ,7)*samplerate,
Gv=parabolicdiff(G,7)*samplerate, #calculate velocity
Hv=parabolicdiff(H,7)*samplerate,
# gazeshifts=markMovementsDouble(Gv,threshold1=100,threshold2=10),
gazeshifts=markSaccadesDouble(Gv,threshold1=100,threshold2=20,
driftcorrect = TRUE,markFixations = FALSE),
headmovement=markMovementsDouble(Hv,threshold1=10,threshold2=4)) %>%
do(markTagetMovements(t=.,buffer=200,threshold=200,trial.length=500))%>%
filter(!is.na(trialnum))->
h
control.subjects<-c('Cj21', 'hS83', 'UG56', 'wR49', 'Fq58')
h %>%
mutate(blocknum=as.factor(str_sub(block,7)),
E=G-H)%>%
filter(!is.na(trialnum)) %>%
group_by(task,subject,block,blocknum,trialnum) %>%
do(measureTrial(.)) %>%
mutate(control = subject %in% control.subjects)->
hm
hplot<-filter(hm,missing.gs<5)
hplot<-filter(hm,missing.gs<5) %>%
mutate(post.saccade.VOR=post.saccade.VOR*-1) %>%
filter(post.saccade.head>10,
post.saccade.VOR<2,
post.saccade.VOR>0.5
)
qplot(post.saccade.VOR,binwidth=.1,data=filter(hplot,abs(post.saccade.VOR)<3))+
facet_wrap(~block,ncol=3,scales='free')+
geom_vline(xintercept = -1)+
xlab('VOR gain')
qplot(post.saccade.VOR,binwidth=.1,data=filter(hplot,abs(post.saccade.VOR)<3))+
facet_wrap(~block,ncol=3,scales='free')+
geom_vline(xintercept = 1)+
xlab('VOR gain')
hplot<-filter(hm,missing.gs<5) %>%
mutate(post.saccade.VOR=post.saccade.VOR*-1) %>%
filter(post.saccade.head>5,
post.saccade.VOR<2,
post.saccade.VOR>0.5
)
qplot(post.saccade.VOR,binwidth=.1,data=filter(hplot,abs(post.saccade.VOR)<3))+
facet_wrap(~block,ncol=3,scales='free')+
geom_vline(xintercept = 1)+
xlab('VOR gain')
ggplot(filter(hplot,abs(post.saccade.VOR)<3))+
geom_boxplot(aes(blocknum,post.saccade.VOR,fill=block))+
facet_wrap(~subject,scales='free',ncol=3)+
geom_hline(yintercept = -1,color='red',alpha=0.5)+
theme(legend.position='none')
ggplot(filter(hplot,abs(post.saccade.VOR)<3))+
geom_boxplot(aes(blocknum,post.saccade.VOR,fill=block))+
facet_wrap(~subject,scales='free',ncol=3)+
geom_hline(yintercept = 1,color='red',alpha=0.5)+
theme(legend.position='none')
ggplot(hplot)+
geom_boxplot(aes(blocknum,post.saccade.VOR,fill=block))+
facet_wrap(~subject,scales='free',ncol=3)+
geom_hline(yintercept = 1,color='red',alpha=0.5)+
theme(legend.position='none')
unique(hplot$subject)
hplot<-filter(hm,missing.gs<5) %>%
mutate(post.saccade.VOR=post.saccade.VOR*-1) %>%
filter(post.saccade.head>5,
post.saccade.VOR<2,
post.saccade.VOR>0.5
)
unique(hplot$subject)
unique(hm$subject)
h %>%
mutate(blocknum=as.factor(str_sub(block,7)),
E=G-H)%>%
filter(!is.na(trialnum)) %>%
group_by(task,subject,block,blocknum,trialnum) %>%
do(measureTrial(.)) %>%
mutate(control = subject %in% control.subjects)->
hm
unique(hm$subject)
unique(h$subject)
path<- "F:/dropbox/kdata/"
h<-loadnewheadfree(path=path)
h %>%
mutate(blocknum=as.factor(str_sub(block,7)),
E=G-H)%>%
filter(!is.na(trialnum)) %>%
group_by(task,subject,block,blocknum,trialnum) %>%
do(measureTrial(.)) %>%
mutate(control = subject %in% control.subjects)->
hm
h%>%
select(G,H,Targ,block,subject,task)%>%
group_by(block) %>%
filter(!is.na(G)) %>%
mutate(time=row_number(),
Graw=G,
G=replace(smooth(G,"3R"),G==0,NA), #mark missing data as NA rather than 0
Gnospline=G,
G= applyspline(G,6),
target.velocity=parabolicdiff(Targ,7)*samplerate,
Gv=parabolicdiff(G,7)*samplerate, #calculate velocity
Hv=parabolicdiff(H,7)*samplerate,
# gazeshifts=markMovementsDouble(Gv,threshold1=100,threshold2=10),
gazeshifts=markSaccadesDouble(Gv,threshold1=100,threshold2=20,
driftcorrect = TRUE,markFixations = FALSE),
headmovement=markMovementsDouble(Hv,threshold1=10,threshold2=4)) %>%
do(markTagetMovements(t=.,buffer=200,threshold=200,trial.length=500))%>%
filter(!is.na(trialnum))->
h
h %>%
mutate(blocknum=as.factor(str_sub(block,7)),
E=G-H)%>%
filter(!is.na(trialnum)) %>%
group_by(task,subject,block,blocknum,trialnum) %>%
do(measureTrial(.)) %>%
mutate(control = subject %in% control.subjects)->
hm
h %>%
mutate(blocknum=as.factor(str_sub(block,7)),
E=G-H)%>%
filter(!is.na(trialnum)) %>%
group_by(task,subject,block,blocknum,trialnum) %>%
do(measureTrial(.)) %>%
mutate(control = subject %in% control.subjects)->
hm
hplot<-filter(hm,missing.gs<5) %>%
mutate(post.saccade.VOR=post.saccade.VOR*-1) %>%
filter(post.saccade.head>5,
post.saccade.VOR<2,
post.saccade.VOR>0.5
)
qplot(post.saccade.VOR,binwidth=.1,data=filter(hplot,abs(post.saccade.VOR)<3))+
facet_wrap(~block,ncol=3,scales='free')+
geom_vline(xintercept = 1)+
xlab('VOR gain')
ggplot(hplot)+
geom_boxplot(aes(blocknum,post.saccade.VOR,fill=block))+
facet_wrap(~subject,scales='free',ncol=3)+
geom_hline(yintercept = 1,color='red',alpha=0.5)+
theme(legend.position='none')
class(hplot$blocknum)
ggplot(hplot)+
geom_boxplot(aes(as.factor(blocknum),post.saccade.VOR,fill=block))+
facet_wrap(~subject,scales='free',ncol=3)+
geom_hline(yintercept = 1,color='red',alpha=0.5)+
theme(legend.position='none')
ggboxplot(filter(hplot,abs(post.saccade.VOR)<5),
x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')
library(ggpubr)
ggboxplot(filter(hplot,abs(post.saccade.VOR)<5),
x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')
hplot %>%
filter(abs(post.saccade.VOR)<5,
control,
blocknum<3) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')
hplot<-filter(hm,missing.gs<5) %>%
mutate(post.saccade.VOR=post.saccade.VOR*-1) %>%
filter(abs(post.saccade.head)>5,
post.saccade.VOR<2,
post.saccade.VOR>0.5
)
qplot(post.saccade.VOR,binwidth=.1,data=filter(hplot,abs(post.saccade.VOR)<3))+
facet_wrap(~block,ncol=3,scales='free')+
geom_vline(xintercept = 1)+
xlab('VOR gain')
ggplot(hplot)+
geom_boxplot(aes(as.factor(blocknum),post.saccade.VOR,fill=block))+
facet_wrap(~subject,scales='free',ncol=3)+
geom_hline(yintercept = 1,color='red',alpha=0.5)+
theme(legend.position='none')
hm %>%
ungroup() %>%
filter(missing.gs<5) %>%
mutate(post.saccade.VOR=post.saccade.VOR*-1) %>%
filter(abs(post.saccade.head)>5,
post.saccade.VOR<2,
post.saccade.VOR>0.5
) ->
hplot
qplot(post.saccade.VOR,binwidth=.1,data=filter(hplot,abs(post.saccade.VOR)<3))+
facet_wrap(~block,ncol=3,scales='free')+
geom_vline(xintercept = 1)+
xlab('VOR gain')
ggplot(hplot)+
geom_boxplot(aes(as.factor(blocknum),post.saccade.VOR,fill=block))+
facet_wrap(~subject,scales='free',ncol=3)+
geom_hline(yintercept = 1,color='red',alpha=0.5)+
theme(legend.position='none')
ggboxplot(filter(hplot,abs(post.saccade.VOR)<5),
x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')
hplot %>%
filter(abs(post.saccade.VOR)<5,
control,
blocknum<3) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')
hplot %>%
ungroup() %>%
filter(subject=='xL16') %>%
filter(blocknum %in% c('5','6')) %>%
mutate(blocknum=as.factor(as.numeric(blocknum)-4))->
hplotXL
hplotconc<-filter(hplot,!control,subject!='xL16',blocknum %in% c('1','2'))
hplotconc<-rbind(ungroup(hplotconc),hplotXL)
hplotconc %>%
filter(abs(post.saccade.VOR)<5) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')
ggplot(filter(hplot,abs(post.saccade.head)>10),aes(post.saccade.head,post.saccade.eye,color=blocknum))+
geom_point()+
geom_abline(slope=-1)+
stat_smooth(method='lm',se=FALSE)+
facet_wrap(~subject,ncol=4,scales='free')+
theme(legend.position='bottom')
ggplot(filter(hplot,abs(post.saccade.head)>10),aes(post.saccade.head,post.saccade.eye,color=blocknum))+
# geom_point()+
geom_abline(slope=-1)+
stat_smooth(method='lm',se=FALSE)+
facet_wrap(~subject,ncol=4,scales='free')+
theme(legend.position='bottom')
drifters<-filter(hplot,abs(post.saccade.drift)>10,abs(post.saccade.head)>10)
drifters %>%
group_by(subject,blocknum) %>%
tally()->
driftcount
hplot %>%
group_by(subject,blocknum) %>%
summarize(total_n=n()) %>%
left_join(driftcount) %>%
mutate(driftpercent=n/total_n)->
alldriftcount
ggplot(driftcount,aes(blocknum,n,fill=subject))+
geom_bar(stat='identity')+
facet_wrap(~subject,scales='free_x')+
ylab('Number of Trials with Post-saccadic Drift')+
theme(legend.position = 'none')+
labs(caption='Trials with missing data omitted')
ggplot(alldriftcount,aes(blocknum,driftpercent,fill=subject))+
geom_bar(stat='identity')+
facet_wrap(~subject,scales='free_x')+
ylab('Percentage of Good Trials with Post-saccadic Drift')+
theme(legend.position = 'none')+
labs(caption='Trials with missing data omitted')
alldriftcount %>%
filter(control=='Control') %>%
ggplot(aes(blocknum,driftpercent,fill=subject))+
geom_bar(stat='identity')+
facet_wrap(~subject,scales='free_x')+
ylab('Fraction of Good Trials with Post-saccadic Drift')+
theme_minimal()+
theme(legend.position = 'none')+
xlab('Time Point')+
ggtitle('Control Subjects')
names(alldriftcount)
drifters<-filter(hplotAdjusted,abs(post.saccade.drift)>10,abs(post.saccade.head)>10)
hplotAdjusted<- rbind(hplotconc,ungroup(filter(hplot,control)))
hplotAdjusted %>%
filter(abs(post.saccade.VOR)<5) %>%
group_by(subject,blocknum) %>%
summarize(median.VOR.gain=mean(post.saccade.VOR))->
gaintab
hplotAdjusted %>%
filter(abs(post.saccade.VOR)<5) %>%
ggboxplot(x = "blocknum", y="post.saccade.VOR",
color = "blocknum", palette = "jco",
facet.by = c("subject"),scales='free_x',ncol=3)+
# stat_compare_means(label="p.signif")+
stat_compare_means()+
theme(legend.position='none')+
xlab('Time Point')+
ylab('Post-saccade VOR gain')
alldriftcount %>%
filter(control=='Control') %>%
ggplot(aes(blocknum,driftpercent,fill=subject))+
geom_bar(stat='identity')+
facet_wrap(~subject,scales='free_x')+
ylab('Fraction of Good Trials with Post-saccadic Drift')+
theme_minimal()+
theme(legend.position = 'none')+
xlab('Time Point')+
ggtitle('Control Subjects')
drifters<-filter(hplotAdjusted,abs(post.saccade.drift)>10,abs(post.saccade.head)>10)
drifters %>%
group_by(subject,blocknum,control) %>%
tally()->
driftcount
hplotAdjusted %>%
group_by(subject,blocknum,control) %>%
summarize(total_n=n()) %>%
left_join(driftcount) %>%
mutate(driftpercent=n/total_n)->
alldriftcount
library(tidyr)
alldriftcount$control<- as.factor(alldriftcount$control)
levels(alldriftcount$control)<-c('Concussed','Control')
alldriftcount %>%
select(-n,-total_n) %>%
ungroup() %>%
spread(key = blocknum,value=driftpercent)->
ss
s$concussed<- as.factor(s$concussed)
ggpaired(ss,cond1='1',cond2='2',facet='control',
palette = 'jco',line.color = "gray", line.size = 0.4)+
stat_compare_means(paired=TRUE)+
xlab('Time Point')+
ylab('Fraction of Trials with post-saccadic drift')
alldriftcount %>%
mutate(post.block=control=='Concussed' & blocknum == '2')->
alldriftcount
alldriftcount$post.block<-as.factor(alldriftcount$post.block)
levels(alldriftcount$post.block)<-c('Control and Pre-concussion','Post-concussion')
ggpaired(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'npg',color='post.block',line.color = "gray", line.size = 0.4)+
stat_compare_means(paired=TRUE)+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
ggboxplot(alldriftcount,x='post.block',y='driftpercent*100',
palette = 'lancet',color='post.block')+
stat_compare_means()+
xlab('Time Point')+
ylab('Percentage of Trials with Post-Saccadic Drift')+
theme(legend.position='none')
alldriftcount %>%
filter(control=='Control') %>%
ggplot(aes(blocknum,driftpercent,fill=subject))+
geom_bar(stat='identity')+
facet_wrap(~subject,scales='free_x')+
ylab('Fraction of Good Trials with Post-saccadic Drift')+
theme_minimal()+
theme(legend.position = 'none')+
xlab('Time Point')+
ggtitle('Control Subjects')
alldriftcount %>%
filter(control=='Concussed') %>%
ggplot(aes(blocknum,driftpercent,fill=subject))+
geom_bar(stat='identity')+
facet_wrap(~subject,scales='free_x')+
ylab('Fraction of Good Trials with Post-saccadic Drift')+
theme_minimal()+
theme(legend.position = 'none')+
xlab('Time Point')
